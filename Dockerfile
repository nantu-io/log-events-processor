FROM python:3.8-slim

# Install openjdk
RUN apt-get update && \
    apt-get install -y --no-install-recommends openjdk-11-jre

# Copy all files
COPY . /amazon-kinesis-client-python

# Use root directory as workdir
WORKDIR /amazon-kinesis-client-python

# Install required dependencies
RUN pip install --no-cache-dir -r requirements.txt && \
    python setup.py download_jars && \
    python setup.py install

# Use ntcore directory as workdir
WORKDIR /amazon-kinesis-client-python/ntcore

# Make entry script executable
RUN chmod 755 log_events_processor.py

# Below command is generated with steps:
# 1. Use `ENTRYPOINT ["tail", "-f", "/dev/null"]` to keep container running
# 2. Build image with above entrypoint and run the container
# 3. Login container via `docker exec -it <container_id> bash`
# 4. Execute command `amazon_kclpy_helper.py --print_command --java <path-to-java> --properties <properties-file>`
CMD [ "/usr/bin/java", "-cp", \
      "/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/json-utils-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/amazon-kinesis-client-2.3.9.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-java-sdk-core-1.12.3.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/third-party-jackson-dataformat-cbor-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/kinesis-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-transport-native-unix-common-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-buffer-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/checker-qual-2.5.2.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-beanutils-1.9.4.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jcommander-1.81.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/annotations-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/sdk-core-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-collections4-4.4.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/http-client-spi-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/animal-sniffer-annotations-1.20.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/eventstream-1.0.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-io-2.9.0.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/metrics-spi-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-common-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-collections-3.2.2.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/rxjava-2.2.21.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jsr305-3.0.2.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/logback-core-1.2.10.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-transport-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/utils-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/amazon-kinesis-client-multilang-2.3.9.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-codec-http-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-java-sdk-sts-1.12.3.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/profiles-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/dynamodb-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jmespath-java-1.12.3.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jackson-annotations-2.13.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jackson-dataformat-cbor-2.13.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/protobuf-java-3.17.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/j2objc-annotations-1.3.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jackson-databind-2.13.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-logging-1.2.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-reactive-streams-2.0.5.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/schema-registry-serde-1.1.5.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-query-protocol-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-transport-native-epoll-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-resolver-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/cloudwatch-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/ion-java-1.5.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/third-party-jackson-core-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/guava-31.0.1-jre.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-handler-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-nio-client-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-cbor-protocol-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/protocol-core-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/sts-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/error_prone_annotations-2.7.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-reactive-streams-http-2.0.5.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-lang3-3.12.0.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-codec-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/regions-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/httpcore-4.4.15.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/logback-classic-1.2.10.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/netty-codec-http2-4.1.72.Final.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/slf4j-api-1.7.32.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/jackson-core-2.13.1.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/httpclient-4.5.13.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/joda-time-2.10.10.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/commons-codec-1.15.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/reactive-streams-1.0.3.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-core-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/apache-client-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/aws-json-protocol-2.17.100.jar:/usr/local/lib/python3.8/site-packages/amazon_kclpy/jars/auth-2.17.100.jar:/amazon-kinesis-client-python/ntcore", \
      "software.amazon.kinesis.multilang.MultiLangDaemon", \
      "--properties-file", \
      "kclpy.properties" ]